{"version":3,"file":"main.js","sources":["main.ts"],"sourcesContent":["import { App, Plugin, TFile, Notice, PluginSettingTab, Setting, normalizePath, Modal } from \"obsidian\";\n\ninterface DirectoryTagMapping {\n    directory: string;\n    tags: string[];\n}\n\ninterface FolderTagPluginSettings {\n    directoryTagMappings: DirectoryTagMapping[];\n}\n\nconst DEFAULT_SETTINGS: FolderTagPluginSettings = {\n    directoryTagMappings: []\n};\n\nexport default class FolderTagPlugin extends Plugin {\n    settings!: FolderTagPluginSettings;\n\n    // -------------------------\n    // Check and handle new subdirectory creation\n    // -------------------------\n    private async checkAndHandleNewSubdirectory(filePath: string) {\n        const dirPath = normalizePath(filePath).split(\"/\").slice(0, -1).join(\"/\");\n        if (dirPath) {\n            await this.handleNewSubdirectory(dirPath);\n        }\n    }\n\n    async onload() {\n        await this.loadSettings();\n        this.addSettingTab(new FolderTagSettingTab(this.app, this));\n\n        this.registerEvent(this.app.vault.on(\"create\", async (file) => {\n            if (file instanceof TFile && file.extension === \"md\") {\n                // Check for new subdirectory creation\n                await this.checkAndHandleNewSubdirectory(file.path);\n                \n                await this.applyFolderTag(file, \"create\");\n            }\n        }));\n\n        this.registerEvent(this.app.vault.on(\"rename\", async (file, oldPath) => {\n            if (file instanceof TFile && file.extension === \"md\") {\n                // Handle directory rename in settings\n                await this.handleDirectoryRename(oldPath, file.path);\n                \n                // Check for new subdirectory creation\n                await this.checkAndHandleNewSubdirectory(file.path);\n                \n                // Apply folder tags for the moved file\n                await this.applyFolderTag(file, \"move\", oldPath);\n            }\n        }));\n    }\n\n    async loadSettings() {\n        this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());\n    }\n\n    async saveSettings() {\n        await this.saveData(this.settings);\n    }\n\n    private getFolderTags(file: TFile): string[] {\n        return this.getFolderTagsFromPath(file.path);\n    }\n\n    private getFolderTagsFromPath(path: string): string[] {\n        const normalized = normalizePath(path);\n        const parts = normalized.split(\"/\").slice(0, -1);\n        if (!parts.length) return [];\n\n        // Generate hierarchical tag using full directory path from project root\n        // Input path: \"main-folder/sub-folder/note.md\" → Output tag: [\"main-folder/sub-folder\"]\n        return [parts.join(\"/\")];\n    }\n\n    // Helper function to get old-style tags (separate tags for each directory)\n    // Used for cleanup operations to ensure backward compatibility\n    private getOldStyleFolderTagsFromPath(path: string): string[] {\n        const normalized = normalizePath(path);\n        const parts = normalized.split(\"/\").slice(0, -1);\n        if (!parts.length) return [];\n\n        // Return each directory in the path as a separate tag (old algorithm)\n        return parts.map(part => part);\n    }\n\n    parseTagsFromString(tagsString: string): string[] {\n        return tagsString.split(\",\").map(t => t.trim()).filter(t => t.length > 0);\n    }\n\n    // -------------------------\n    // Handle directory rename in settings\n    // -------------------------\n    private async handleDirectoryRename(oldPath: string, newPath: string) {\n        const oldDir = normalizePath(oldPath).split(\"/\").slice(0, -1).join(\"/\");\n        const newDir = normalizePath(newPath).split(\"/\").slice(0, -1).join(\"/\");\n        \n        // Check if directory actually changed\n        if (oldDir === newDir) return;\n        \n        // Track if any mappings were updated\n        let updated = false;\n        \n        // Update any matching directory mappings\n        for (const mapping of this.settings.directoryTagMappings) {\n            const normalizedMapping = normalizePath(mapping.directory);\n            \n            // Requirement 1: Only update mappings that exactly match the renamed directory\n            // Do not automatically update subdirectory mappings\n            if (normalizedMapping === oldDir) {\n                // Replace the old directory path with the new one\n                mapping.directory = newDir;\n                updated = true;\n            }\n        }\n        \n        // Save settings if any mappings were updated\n        if (updated) {\n            await this.saveSettings();\n            new Notice(\"Directory mappings updated for renamed folder\");\n        }\n    }\n\n    // -------------------------\n    // Find parent directory mapping for a given path\n    // -------------------------\n    private findParentDirectoryMapping(dirPath: string): DirectoryTagMapping | null {\n        const normalized = normalizePath(dirPath);\n        let closestParent: DirectoryTagMapping | null = null;\n        let closestParentDepth = -1;\n        \n        // Check each mapping to see if it's a parent of this directory\n        for (const mapping of this.settings.directoryTagMappings) {\n            const normalizedMapping = normalizePath(mapping.directory);\n            \n            // Skip empty mappings or if this is the same directory\n            if (!normalizedMapping || normalizedMapping === normalized) continue;\n            \n            // Check if the mapping is a parent directory\n            if (normalized.startsWith(normalizedMapping + \"/\")) {\n                // Find the closest parent (deepest in the hierarchy)\n                const depth = normalizedMapping.split(\"/\").length;\n                if (depth > closestParentDepth) {\n                    closestParent = mapping;\n                    closestParentDepth = depth;\n                }\n            }\n        }\n        \n        return closestParent;\n    }\n\n    // -------------------------\n    // Check if a directory already has a mapping\n    // -------------------------\n    private hasDirectoryMapping(dirPath: string): boolean {\n        const normalized = normalizePath(dirPath);\n        return this.settings.directoryTagMappings.some(\n            mapping => normalizePath(mapping.directory) === normalized\n        );\n    }\n\n    // -------------------------\n    // Handle new subdirectory creation (Requirement 2)\n    // -------------------------\n    private async handleNewSubdirectory(dirPath: string) {\n        const normalized = normalizePath(dirPath);\n        \n        // Skip if this directory already has a mapping\n        // This prevents overwriting user-customized mappings and avoids duplicate processing\n        if (this.hasDirectoryMapping(normalized)) {\n            return;\n        }\n        \n        // Find parent mapping\n        const parentMapping = this.findParentDirectoryMapping(normalized);\n        \n        // If there's a parent mapping, inherit its tags\n        if (parentMapping && parentMapping.tags.length > 0) {\n            const newMapping: DirectoryTagMapping = {\n                directory: normalized,\n                tags: [...parentMapping.tags]  // Inherit tags from parent\n            };\n            \n            this.settings.directoryTagMappings.push(newMapping);\n            await this.saveSettings();\n            \n            // Apply tags to any existing files in this directory\n            const appliedCount = await this.applyTagsForMapping(newMapping);\n            new Notice(`New subdirectory detected: ${normalized}. Inherited tags from parent. Applied to ${appliedCount} note(s).`);\n        }\n    }\n\n    private getCustomDirectoryTags(path: string): string[] {\n        const normalized = normalizePath(path);\n        const customTags: string[] = [];\n        \n        // Get the directory path (remove the filename)\n        const dirPath = normalized.split(\"/\").slice(0, -1).join(\"/\");\n        \n        // Check each directory in the path against custom mappings\n        for (const mapping of this.settings.directoryTagMappings) {\n            const normalizedDir = normalizePath(mapping.directory);\n            \n            // Skip empty directory mappings\n            if (!normalizedDir) continue;\n            \n            // Check if the file is within this directory\n            // Either the dir path equals the mapping directory, or it's a subdirectory\n            if (dirPath === normalizedDir || dirPath.startsWith(normalizedDir + \"/\")) {\n                customTags.push(...mapping.tags);\n            }\n        }\n        \n        return customTags;\n    }\n\n    private getAllTags(path: string): string[] {\n        const folderTags = this.getFolderTagsFromPath(path);\n        const customTags = this.getCustomDirectoryTags(path);\n        \n        // Combine and deduplicate tags\n        const allTags = [...folderTags, ...customTags];\n        return [...new Set(allTags)];\n    }\n\n    // -------------------------\n    // Apply folder tags\n    // -------------------------\n    async applyFolderTag(file: TFile, action: \"create\" | \"move\" | \"rerun\", oldPath?: string) {\n        const folderTags = this.getAllTags(file.path);\n        if (!folderTags.length) return;\n\n        await this.app.fileManager.processFrontMatter(file, yaml => {\n            if (!yaml || typeof yaml !== \"object\") return;\n\n            let existingTags: string[] = [];\n            if (\"tags\" in yaml) {\n                if (Array.isArray(yaml.tags)) existingTags.push(...yaml.tags.map((t: string | number) => String(t).trim()));\n                else if (typeof yaml.tags === \"string\") existingTags.push(...yaml.tags.split(\",\").map((t: string) => t.trim()));\n            }\n\n            // Remove old folder tags if moving/rerunning\n            if (action === \"move\" && oldPath) {\n                // For move: remove tags based on the old file path\n                const oldTags = this.getAllTags(oldPath);\n                const oldStyleTags = this.getOldStyleFolderTagsFromPath(oldPath);\n                const allOldTags = [...oldTags, ...oldStyleTags];\n                existingTags = existingTags.filter(t => !allOldTags.includes(t));\n            } else if (action === \"rerun\") {\n                // For rerun: remove both old-style and new-style tags to ensure clean migration\n                const currentTags = this.getAllTags(file.path);\n                const oldStyleTags = this.getOldStyleFolderTagsFromPath(file.path);\n                const allTagsToRemove = [...currentTags, ...oldStyleTags];\n                existingTags = existingTags.filter(t => !allTagsToRemove.includes(t));\n            }\n\n            // Add new folder tags\n            folderTags.forEach(t => { if (!existingTags.includes(t)) existingTags.push(t); });\n\n            yaml.tags = existingTags;\n        });\n    }\n\n\n    // -------------------------\n    // Remove tags for a specific directory mapping\n    // -------------------------\n    async removeTagsForMapping(mapping: DirectoryTagMapping) {\n        const files = this.app.vault.getMarkdownFiles();\n        let removedCount = 0;\n\n        for (const file of files) {\n            const normalized = normalizePath(file.path);\n            const dirPath = normalized.split(\"/\").slice(0, -1).join(\"/\");\n            const normalizedDir = normalizePath(mapping.directory);\n\n            // Check if file is in this directory\n            if (dirPath === normalizedDir || dirPath.startsWith(normalizedDir + \"/\")) {\n                await this.app.fileManager.processFrontMatter(file, yaml => {\n                    if (!yaml || typeof yaml !== \"object\") return;\n\n                    let existingTags: string[] = [];\n                    if (\"tags\" in yaml) {\n                        const val = yaml.tags;\n                        if (Array.isArray(val)) existingTags.push(...val.map(v => String(v).trim()));\n                        else if (typeof val === \"string\") existingTags.push(...val.split(\",\").map(v => v.trim()));\n                    }\n\n                    const originalLength = existingTags.length;\n                    // Remove only the tags from this mapping\n                    existingTags = existingTags.filter(t => !mapping.tags.includes(t));\n\n                    if (existingTags.length < originalLength) {\n                        removedCount++;\n                    }\n\n                    if (existingTags.length === 0) delete yaml.tags;\n                    else yaml.tags = existingTags;\n                });\n            }\n        }\n\n        return removedCount;\n    }\n\n    // -------------------------\n    // Apply tags for a specific directory mapping to existing notes\n    // -------------------------\n    async applyTagsForMapping(mapping: DirectoryTagMapping) {\n        if (!mapping.directory || mapping.tags.length === 0) {\n            return 0;\n        }\n\n        const files = this.app.vault.getMarkdownFiles();\n        let appliedCount = 0;\n\n        for (const file of files) {\n            const normalized = normalizePath(file.path);\n            const dirPath = normalized.split(\"/\").slice(0, -1).join(\"/\");\n            const normalizedDir = normalizePath(mapping.directory);\n\n            // Check if file is in this directory\n            if (dirPath === normalizedDir || dirPath.startsWith(normalizedDir + \"/\")) {\n                await this.app.fileManager.processFrontMatter(file, yaml => {\n                    if (!yaml || typeof yaml !== \"object\") return;\n\n                    let existingTags: string[] = [];\n                    if (\"tags\" in yaml) {\n                        const val = yaml.tags;\n                        if (Array.isArray(val)) existingTags.push(...val.map(v => String(v).trim()));\n                        else if (typeof val === \"string\") existingTags.push(...val.split(\",\").map(v => v.trim()));\n                    }\n\n                    const originalLength = existingTags.length;\n                    // Add tags from this mapping\n                    mapping.tags.forEach(tag => {\n                        if (!existingTags.includes(tag)) {\n                            existingTags.push(tag);\n                        }\n                    });\n\n                    if (existingTags.length > originalLength) {\n                        appliedCount++;\n                    }\n\n                    yaml.tags = existingTags;\n                });\n            }\n        }\n\n        return appliedCount;\n    }\n\n    // -------------------------\n    // Update tags when mapping tags are changed\n    // -------------------------\n    async updateTagsForMapping(mapping: DirectoryTagMapping, oldTags: string[]) {\n        if (!mapping.directory) {\n            return 0;\n        }\n\n        const files = this.app.vault.getMarkdownFiles();\n        let updatedCount = 0;\n\n        for (const file of files) {\n            const normalized = normalizePath(file.path);\n            const dirPath = normalized.split(\"/\").slice(0, -1).join(\"/\");\n            const normalizedDir = normalizePath(mapping.directory);\n\n            // Check if file is in this directory\n            if (dirPath === normalizedDir || dirPath.startsWith(normalizedDir + \"/\")) {\n                await this.app.fileManager.processFrontMatter(file, yaml => {\n                    if (!yaml || typeof yaml !== \"object\") return;\n\n                    let existingTags: string[] = [];\n                    if (\"tags\" in yaml) {\n                        const val = yaml.tags;\n                        if (Array.isArray(val)) existingTags.push(...val.map(v => String(v).trim()));\n                        else if (typeof val === \"string\") existingTags.push(...val.split(\",\").map(v => v.trim()));\n                    }\n\n                    let modified = false;\n\n                    // Remove old tags\n                    const beforeRemoval = existingTags.length;\n                    existingTags = existingTags.filter(t => !oldTags.includes(t));\n                    if (existingTags.length < beforeRemoval) {\n                        modified = true;\n                    }\n\n                    // Add new tags\n                    mapping.tags.forEach(tag => {\n                        if (!existingTags.includes(tag)) {\n                            existingTags.push(tag);\n                            modified = true;\n                        }\n                    });\n\n                    if (modified) {\n                        updatedCount++;\n                    }\n\n                    if (existingTags.length === 0) delete yaml.tags;\n                    else yaml.tags = existingTags;\n                });\n            }\n        }\n\n        return updatedCount;\n    }\n\n    // -------------------------\n    // Clean and reapply all tags (recheck all settings and apply cleanly)\n    // -------------------------\n    async cleanAndReapplyAllTags() {\n        const files = this.app.vault.getMarkdownFiles();\n        let processedCount = 0;\n\n        for (const file of files) {\n            try {\n                // Remove current folder tags and reapply them\n                await this.applyFolderTag(file, \"rerun\");\n                processedCount++;\n            } catch (e) {\n                console.error(\"Failed to process file:\", file.path, e);\n            }\n        }\n\n        return processedCount;\n    }\n\n    // -------------------------\n    // Complete reset: remove all plugin-generated tags and clear custom mappings\n    // -------------------------\n    async completeReset() {\n        const files = this.app.vault.getMarkdownFiles();\n        let processedCount = 0;\n\n        for (const file of files) {\n            try {\n                const allTags = this.getAllTags(file.path);\n                const oldStyleTags = this.getOldStyleFolderTagsFromPath(file.path);\n                const allTagsToRemove = [...allTags, ...oldStyleTags];\n                if (!allTagsToRemove.length) continue;\n\n                await this.app.fileManager.processFrontMatter(file, yaml => {\n                    if (!yaml || typeof yaml !== \"object\") return;\n\n                    let existingTags: string[] = [];\n                    if (\"tags\" in yaml) {\n                        const val = yaml.tags;\n                        if (Array.isArray(val)) existingTags.push(...val.map(v => String(v).trim()));\n                        else if (typeof val === \"string\") existingTags.push(...val.split(\",\").map(v => v.trim()));\n                    }\n\n                    // Remove all plugin-generated tags (both old-style and new-style)\n                    existingTags = existingTags.filter(t => !allTagsToRemove.includes(t));\n\n                    if (existingTags.length === 0) delete yaml.tags;\n                    else yaml.tags = existingTags;\n                });\n                \n                processedCount++;\n            } catch (e) {\n                console.error(\"Failed to process file:\", file.path, e);\n            }\n        }\n\n        // Clear all custom directory mappings\n        this.settings.directoryTagMappings = [];\n        await this.saveSettings();\n\n        return processedCount;\n    }\n}\n\n// -------------------------\n// Confirmation Modal\n// -------------------------\nclass ConfirmationModal extends Modal {\n    message: string;\n    onConfirm: () => void;\n    onCancel?: () => void;\n\n    constructor(app: App, message: string, onConfirm: () => void, onCancel?: () => void) {\n        super(app);\n        this.message = message;\n        this.onConfirm = onConfirm;\n        this.onCancel = onCancel;\n    }\n\n    onOpen() {\n        const { contentEl } = this;\n        contentEl.empty();\n        \n        contentEl.createEl(\"h2\", { text: \"Confirm action\" });\n        contentEl.createEl(\"p\", { text: this.message });\n        \n        const buttonContainer = contentEl.createDiv({ cls: \"modal-button-container\" });\n        \n        const confirmBtn = buttonContainer.createEl(\"button\", {\n            text: \"Confirm\",\n            cls: \"mod-cta\"\n        });\n        confirmBtn.addEventListener(\"click\", () => {\n            this.close();\n            this.onConfirm();\n        });\n        \n        const cancelBtn = buttonContainer.createEl(\"button\", {\n            text: \"Cancel\"\n        });\n        cancelBtn.addEventListener(\"click\", () => {\n            this.close();\n            if (this.onCancel) {\n                this.onCancel();\n            }\n        });\n    }\n\n    onClose() {\n        const { contentEl } = this;\n        contentEl.empty();\n    }\n}\n\n// -------------------------\n// Settings Tab\n// -------------------------\nclass FolderTagSettingTab extends PluginSettingTab {\n    plugin: FolderTagPlugin;\n\n    constructor(app: App, plugin: FolderTagPlugin) {\n        super(app, plugin);\n        this.plugin = plugin;\n    }\n\n    displayDirectoryMappings(containerEl: HTMLElement): void {\n        this.plugin.settings.directoryTagMappings.forEach((mapping, index) => {\n            // Store original values to detect changes\n            const originalDirectory = mapping.directory;\n            const originalTags = [...mapping.tags];\n            \n            const setting = new Setting(containerEl)\n                .setClass(\"directory-mapping-item\")\n                .addText(text => {\n                    text.setPlaceholder(\"Directory path (e.g., parent-folder/sub-folder)\")\n                        .setValue(mapping.directory);\n                    \n                    // Handle blur event for directory path\n                    text.inputEl.addEventListener('blur', async () => {\n                        const newDirectory = text.getValue();\n                        \n                        // Check if directory actually changed\n                        if (newDirectory !== originalDirectory && originalDirectory) {\n                            const message = `Change directory path?\\n\\nOld path: \"${originalDirectory}\"\\nNew path: \"${newDirectory}\"\\n\\nThis will remove tags from notes in the old directory and apply them to the new directory.`;\n                            \n                            new ConfirmationModal(this.app, message, async () => {\n                                new Notice(\"Updating directory mapping...\");\n                                \n                                // Remove tags from old directory\n                                const oldMapping = {\n                                    directory: originalDirectory,\n                                    tags: mapping.tags\n                                };\n                                await this.plugin.removeTagsForMapping(oldMapping);\n                                \n                                // Update directory and apply to new directory\n                                mapping.directory = newDirectory;\n                                await this.plugin.saveSettings();\n                                \n                                if (newDirectory && mapping.tags.length > 0) {\n                                    const appliedCount = await this.plugin.applyTagsForMapping(mapping);\n                                    new Notice(`Directory updated. Tags applied to ${appliedCount} note(s).`);\n                                }\n                                \n                                this.display();\n                            }, () => {\n                                // On cancel, restore original value\n                                text.setValue(originalDirectory);\n                                mapping.directory = originalDirectory;\n                            }).open();\n                        } else {\n                            mapping.directory = newDirectory;\n                            await this.plugin.saveSettings();\n                        }\n                    });\n                })\n                .addText(text => {\n                    text.setPlaceholder(\"Tags (comma-separated, e.g., python, server-script)\")\n                        .setValue(mapping.tags.join(\", \"));\n                    \n                    // Handle blur event for tags\n                    text.inputEl.addEventListener('blur', async () => {\n                        const newTagsString = text.getValue();\n                        const newTags = this.plugin.parseTagsFromString(newTagsString);\n                        \n                        // Check if tags actually changed\n                        const tagsChanged = JSON.stringify(originalTags.sort()) !== JSON.stringify(newTags.sort());\n                        \n                        if (tagsChanged && originalTags.length > 0 && mapping.directory) {\n                            const message = `Update tags?\\n\\nOld tags: [${originalTags.join(\", \")}]\\nNew tags: [${newTags.join(\", \")}]\\n\\nThis will update all notes in \"${mapping.directory}\".`;\n                            \n                            new ConfirmationModal(this.app, message, async () => {\n                                new Notice(\"Updating tags in notes...\");\n                                mapping.tags = newTags;\n                                const updatedCount = await this.plugin.updateTagsForMapping(mapping, originalTags);\n                                await this.plugin.saveSettings();\n                                new Notice(`Tags updated in ${updatedCount} note(s).`);\n                                this.display();\n                            }, () => {\n                                // On cancel, restore original value\n                                text.setValue(originalTags.join(\", \"));\n                                mapping.tags = originalTags;\n                            }).open();\n                        } else if (tagsChanged && originalTags.length === 0 && mapping.directory && newTags.length > 0) {\n                            // First time adding tags - apply to existing notes automatically without confirmation\n                            new Notice(\"Applying tags to existing notes...\");\n                            mapping.tags = newTags;\n                            await this.plugin.saveSettings();\n                            const appliedCount = await this.plugin.applyTagsForMapping(mapping);\n                            new Notice(`Tags applied to ${appliedCount} note(s).`);\n                            this.display();\n                        } else {\n                            mapping.tags = newTags;\n                            await this.plugin.saveSettings();\n                        }\n                    });\n                })\n                .addButton(btn => btn\n                    .setButtonText(\"Remove\")\n                    .setWarning()\n                    .onClick(async () => {\n                        const mappingToRemove = mapping;\n                        const message = `Remove directory mapping \"${mappingToRemove.directory}\" → [${mappingToRemove.tags.join(\", \")}]?\\n\\nThis will also remove these tags from all notes in this directory.`;\n                        \n                        new ConfirmationModal(this.app, message, async () => {\n                            new Notice(\"Removing tags from notes...\");\n                            \n                            // Remove tags from notes first\n                            const removedCount = await this.plugin.removeTagsForMapping(mappingToRemove);\n                            \n                            // Then remove the mapping from settings\n                            this.plugin.settings.directoryTagMappings.splice(index, 1);\n                            await this.plugin.saveSettings();\n                            \n                            new Notice(`Mapping removed. Tags removed from ${removedCount} note(s).`);\n                            this.display();\n                        }).open();\n                    })\n                );\n        });\n    }\n\n    display(): void {\n        const { containerEl } = this;\n        containerEl.empty();\n        new Setting(containerEl).setHeading().setName(\"Folder to tag\");\n\n        // Custom Directory Tags Section\n        new Setting(containerEl).setHeading().setName(\"Custom directory tags\");\n        \n        new Setting(containerEl)\n            .setName(\"Directory tag mappings\")\n            .setDesc(\"Add custom tags for specific directories. Example: 'php-aws-sdk' → tags: 'php, aws'\");\n\n        this.displayDirectoryMappings(containerEl);\n\n        new Setting(containerEl)\n            .addButton(btn => btn\n                .setButtonText(\"Add directory mapping\")\n                .onClick(async () => {\n                    this.plugin.settings.directoryTagMappings.push({\n                        directory: \"\",\n                        tags: []\n                    });\n                    await this.plugin.saveSettings();\n                    this.display();\n                })\n            );\n\n        // New operations section\n        new Setting(containerEl).setHeading().setName(\"Operations\");\n\n        new Setting(containerEl)\n            .setName(\"Clean and reapply all tags\")\n            .setDesc(\"Rechecks all settings and directory structure, then cleanly reapplies all tags to all notes\")\n            .addButton(btn => btn\n                .setButtonText(\"Clean & Reapply\")\n                .setCta()\n                .onClick(async () => {\n                    new Notice(\"Cleaning and reapplying all tags...\");\n                    const processedCount = await this.plugin.cleanAndReapplyAllTags();\n                    new Notice(`Tags cleaned and reapplied to ${processedCount} note(s)!`);\n                })\n            );\n\n        new Setting(containerEl)\n            .setName(\"Complete reset\")\n            .setDesc(\"Removes all plugin-generated tags from all notes and clears all custom directory mappings. This action cannot be undone.\")\n            .addButton(btn => btn\n                .setButtonText(\"Complete Reset\")\n                .setWarning()\n                .onClick(async () => {\n                    const message = \"This will remove all plugin-generated tags from all notes and clear all custom directory mappings. This action cannot be undone.\\n\\nAre you sure you want to proceed?\";\n                    \n                    new ConfirmationModal(this.app, message, async () => {\n                        new Notice(\"Performing complete reset...\");\n                        const processedCount = await this.plugin.completeReset();\n                        new Notice(`Reset complete! Tags removed from ${processedCount} note(s) and all custom mappings cleared.`);\n                        this.display();\n                    }).open();\n                })\n            );\n    }\n}\n"],"names":["Plugin","normalizePath","TFile","Notice","Modal","PluginSettingTab","Setting"],"mappings":"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"}